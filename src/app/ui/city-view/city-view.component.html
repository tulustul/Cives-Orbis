<div class="panel box-shadowed left">
  <div class="size-and-growth margin">
    <span class="size">{{ city.size }}</span>

    <app-progress-bar
      class="growth-bar"
      [progress]="city.totalFood"
      [nextProgress]="city.totalFood + city.perTurn.food"
      [total]="city.foodToGrow"
    >
      <span class="turns" *ngIf="city.perTurn.food > 0"
        >will grow in {{ city.turnsToGrow | turns }} turns</span
      >
      <span class="turns" *ngIf="city.perTurn.food < 0"
        >will shrink in {{ -city.turnsToGrow | turns }} turns</span
      >
      <span class="turns" *ngIf="city.perTurn.food === 0">growth stalled</span>
    </app-progress-bar>
  </div>

  <h3>Yields</h3>

  <div class="margin-h">
    <div class="yield">
      <div class="label">Food</div>
      <div class="value">
        {{ city.yields.food }} - {{ city.foodConsumed }} =
        {{ city.perTurn.food }}
      </div>
    </div>
    <div class="yield">
      <div class="label">Production</div>
      <div class="value">{{ city.perTurn.production }}</div>
    </div>
  </div>

  <button class="margin-h margin-top" (click)="city.optimizeYields()">
    Optimize yields
  </button>

  <div class="separator"></div>

  <h3>Production</h3>

  <app-progress-bar
    class="production-bar margin"
    *ngIf="city.currentProduct"
    [progress]="city.totalProduction"
    [nextProgress]="city.totalProduction + city.perTurn.production"
    [total]="city.currentProduct?.productionCost"
  >
    <div>
      <span class="name">
        {{ city.currentProduct?.name || "-" }}
      </span>
      <span class="turns" *ngIf="city.currentProduct">
        {{ city.turnsToProductionEnd }} turns
      </span>
    </div>
  </app-progress-bar>

  <app-tabs class="grow-tabs">
    <app-tab class="no-padding" tabTitle="recruit">
      <div
        class="product"
        *ngFor="let unitDef of UNITS"
        (click)="city.produceUnit(unitDef)"
      >
        <span class="name">
          {{ unitDef.name }}
        </span>
        <span class="turns small">
          {{ city.getTurnsToProduce(unitDef) }} turns
        </span>
      </div>
    </app-tab>

    <app-tab class="no-padding" tabTitle="construct">
      <div
        class="product"
        *ngFor="let buildingDef of buildings"
        (click)="city.produceBuilding(buildingDef)"
      >
        <span class="name">
          {{ buildingDef.name }}
        </span>
        <span class="turns small">
          {{ city.getTurnsToProduce(buildingDef) }} turns
        </span>
      </div>
    </app-tab>

    <app-tab class="no-padding" tabTitle="work on"> </app-tab>
  </app-tabs>
</div>

<div class="city-name">
  <h2 class="box-shadowed">{{ city.name }}</h2>
  <button class="btn-primary box-shadowed" (click)="quit()">Return</button>
</div>

<div class="panel box-shadowed right">
  <h3>Buildings</h3>

  <div class="building" *ngFor="let building of city.buildings">
    {{ building.name }}
  </div>
</div>

<app-work-tiles [city]="city"></app-work-tiles>
